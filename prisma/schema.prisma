generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Giveaway {
  id                    Int      @id @default(autoincrement())
  messageId             String   @unique
  channelId             String
  guildId               String
  hostId                String
  prize                 String
  winnersCount          Int
  endTime               BigInt   // Unix timestamp in milliseconds
  ended                 Boolean  @default(false)
  paused                Boolean  @default(false)
  pausedAt              BigInt?
  createdAt             BigInt
  customMessage         String?

  // Requirements
  roleRequirement       String?
  inviteRequirement     Int      @default(0)
  accountAgeRequirement Int      @default(0)
  serverAgeRequirement  Int      @default(0)
  captchaRequirement    Boolean  @default(false)
  messageRequired       Int      @default(0)
  voiceRequirement      Int      @default(0)

  // New Features
  assignRole            String?
  winnerRole            String?
  thumbnail             String?
  emoji                 String   @default("ðŸŽ‰")

  participants          Participant[]
  winners               Winner[]
}

model Participant {
  id         Int      @id @default(autoincrement())
  giveawayId Int
  userId     String
  joinedAt   BigInt
  giveaway   Giveaway @relation(fields: [giveawayId], references: [id])
}

model Winner {
  id         Int      @id @default(autoincrement())
  giveawayId Int
  userId     String
  wonAt      BigInt
  giveaway   Giveaway @relation(fields: [giveawayId], references: [id])
}

model UserStats {
  id           Int    @id @default(autoincrement())
  guildId      String
  userId       String
  messageCount Int    @default(0)
  voiceMinutes Int    @default(0)
  inviteCount  Int    @default(0)

  @@unique([guildId, userId])
}

model InviteTracker {
  id        Int      @id @default(autoincrement())
  guildId   String
  inviterId String
  inviteeId String
  code      String?
  createdAt DateTime @default(now())

  @@unique([guildId, inviteeId])
}


model ScheduledGiveaway {
  id                    Int      @id @default(autoincrement())
  channelId             String
  guildId               String
  hostId                String
  prize                 String
  winnersCount          Int
  payload               String   // JSON string containing all options (duration, requirements, roles, etc.)
  startTime             BigInt   // Unix timestamp in milliseconds when it should start
  createdAt             DateTime @default(now())
}


model BirthdayConfig {
  id           Int      @id @default(autoincrement())
  guildId      String   @unique
  birthdayRole String?
  pingRole     String?
  message      String?
}

model GiveawayConfig {
  guildId     String @id
  managerRole String?
  prefix      String @default("!")
}

model NoPrefixUser {
  id        Int      @id @default(autoincrement())
  userId    String   @unique
  username  String
  createdAt DateTime @default(now())
}

model BlacklistChannel {
  id        Int      @id @default(autoincrement())
  guildId   String
  channelId String
  type      String   // "message" or "voice"
  createdAt DateTime @default(now())

  @@unique([guildId, channelId, type])
}
